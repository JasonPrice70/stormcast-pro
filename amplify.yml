version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== AMPLIFY BUILD DIAGNOSTICS ==="
        - node --version
        - npm --version
        - echo "Current directory contents:"
        - ls -la
        - echo "Installing dependencies..."
        - npm ci
        - echo "Verifying Vite installation..."
        - ls -la node_modules/.bin/vite || echo "Vite not found in .bin"
        - npx vite --version || echo "Vite not accessible via npx"
        - echo "=== DEPENDENCIES INSTALLED ==="
    build:
      commands:
        - echo "=== STARTING BUILD ==="
        - echo "Building React app with Vite (using simplified config)..."
        - npx vite build --config vite.config.amplify.js
        - echo "=== BUILD COMPLETED ==="
        - echo "Checking build output..."
        - ls -la dist/ || echo "No dist folder found"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
