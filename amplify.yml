version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== AMPLIFY BUILD DIAGNOSTICS ==="
        - node --version
        - npm --version
        - echo "Current directory contents:"
        - ls -la
        - echo "Installing dependencies..."
        - rm -rf node_modules package-lock.json || true
        - npm install
        - echo "Verifying node_modules exists:"
        - ls -la node_modules/ || echo "node_modules directory not created"
        - echo "Checking .bin directory:"
        - ls -la node_modules/.bin/ || echo "node_modules/.bin directory not found"
        - echo "Checking for Vite specifically:"
        - test -f node_modules/.bin/vite && echo "Vite binary found" || echo "Vite binary NOT found"
        - echo "=== DEPENDENCIES INSTALLED ==="
    build:
      commands:
        - echo "=== STARTING BUILD ==="
        - echo "Final check before build:"
        - ls -la node_modules/.bin/ | head -10
        - echo "Running build with npx to ensure Vite is found..."
        - npx vite build
        - echo "=== BUILD COMPLETED ==="
        - echo "Checking build output..."
        - ls -la dist/ || echo "No dist folder found"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
